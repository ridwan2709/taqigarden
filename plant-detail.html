<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plant Details - Taqi Garden</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Inter:wght@300;400;600&display=swap');

        :root {
            --primary-green: #2d4a3e;
            --accent-green: #4f7962;
            --cream: #f9f7f2;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--cream);
            color: #333;
        }

        h1, h2, h3, .brand-font {
            font-family: 'Playfair Display', serif;
        }

        .whatsapp-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background-color: #25d366;
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            box-shadow: 2px 5px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .whatsapp-btn:hover {
            transform: scale(1.1);
            background-color: #128c7e;
        }
        #plantImage {
            transition: opacity 0.5s ease-in-out;
        }

        .fade-out {
            opacity: 0;
        }
    </style>
</head>
<body class="bg-[#f9f7f2]">
    <!-- WhatsApp Button -->
    <a href="https://wa.me/6285121090713?text=Hello%20Taqi%20Garden,%20I%20am%20interested%20in%20your%20plant%20collection." target="_blank" class="whatsapp-btn" title="Contact via WhatsApp">
        <i class="fab fa-whatsapp"></i>
    </a>
     <!-- Header will be loaded here by JavaScript -->
    <div id="header-placeholder"></div>
    <script src="js/header-loader.js"></script>

    <!-- Plant Detail Section -->
    <section class="py-12 md:py-20">
        <div class="container mx-auto px-6">
            <div id="loading" class="text-center py-20 text-[#2d4a3e]">
                <i class="fas fa-circle-notch fa-spin text-4xl"></i>
                <p class="mt-4">Loading plant details...</p>
            </div>

            <div id="plantDetail" class="hidden bg-white rounded-2xl shadow-lg overflow-hidden">
                <div class="md:flex">
                    <!-- Plant Image -->
                    <div class="md:w-1/2 p-4">
                        <div class="relative">
                            <img id="plantImage" src="" alt="Plant" class="w-full h-auto rounded-lg shadow-md aspect-square object-cover">
                        </div>
                        <!-- Image Gallery -->
                        <div id="imageGallery" class="flex flex-wrap gap-2 mt-4">
                            <!-- Thumbnails will be added here by JavaScript -->
                        </div>
                         <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6 rounded">
                                <h4 class="font-semibold text-yellow-800 mb-2">What You Need to Know</h4>
                                <p class="text-yellow-700 text-sm">
                                    For orders placed, the actual plant may differ slightly from the photos in the catalog. We ensure that the plant sent matches the same name and type, but there might be variations in the number of leaves, width, and height. Before shipping, we will verify with you by sending real photos/videos of the exact plant to be shipped.
                                </p>
                            </div>
                    </div>
                    
                    <!-- Plant Info -->
                    <div class="p-8 md:w-1/2">
                        <span id="plantCategory" class="inline-block px-3 py-1 text-xs font-semibold text-white bg-[#4f7962] rounded-full mb-4">
                            Category
                        </span>
                        <h1 id="plantName" class="text-3xl md:text-4xl font-bold mb-4">Plant Name</h1>
                        <p id="plantPrice" class="text-2xl text-[#2d4a3e] font-bold mb-6">Loading price...</p>
                        
                        <div class="mb-8">
                            <h3 class="text-lg font-semibold mb-3">Description</h3>
                            <p id="plantDescription" class="text-gray-600 mb-6">Loading description...</p>
                            
                            <div class="grid grid-cols-2 gap-4 mb-6">
                                <div>
                                    <p class="text-sm text-gray-500">Light</p>
                                    <p id="plantLight" class="font-medium">-</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500">Water</p>
                                    <p id="plantWater" class="font-medium">-</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500">Humidity</p>
                                    <p id="plantHumidity" class="font-medium">-</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500">Toxicity</p>
                                    <p id="plantToxicity" class="font-medium">-</p>
                                </div>
                            </div>
                        </div>
                        
                        <button id="contactBtn" class="w-full bg-[#2d4a3e] text-white py-3 rounded-lg hover:bg-[#4f7962] transition font-semibold">
                            <i class="fab fa-whatsapp mr-2"></i> Contact Us on WhatsApp
                        </button>
                    </div>
                </div>
            </div>

            <div id="errorMessage" class="hidden text-center py-20">
                <i class="fas fa-exclamation-triangle text-4xl text-red-500 mb-4"></i>
                <h2 class="text-2xl font-bold mb-4">Plant Not Found</h2>
                <p class="text-gray-600 mb-6">The plant you're looking for doesn't exist or has been removed.</p>
                <a href="koleksi.html" class="inline-block bg-[#2d4a3e] text-white px-6 py-2 rounded-lg hover:bg-[#4f7962] transition">
                    Back to Collection
                </a>
            </div>
        </div>
    </section>

    <!-- Similar Plants Section -->
    <section class="py-12 bg-white">
        <div class="container mx-auto px-6">
            <h2 class="text-3xl text-center mb-12">You May Also Like</h2>
            <div id="similarPlants" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
                <!-- Similar plants will be loaded here -->
            </div>
        </div>
    </section>
    <!-- Footer will be loaded here by JavaScript -->
    <div id="footer-placeholder"></div>
    <script type="module" src="js/footer-loader.js"></script>
    
    <script>
        // Pastikan DOM sudah dimuat sepenuhnya
        document.addEventListener('DOMContentLoaded', function() {
            // Inisialisasi komponen JavaScript di sini jika diperlukan
            console.log('Cargo page loaded successfully');
            
            // Contoh inisialisasi komponen (sesuaikan dengan kebutuhan)
            const whatsappBtn = document.querySelector('.whatsapp-btn');
            if (whatsappBtn) {
                whatsappBtn.addEventListener('click', function() {
                    // Track WhatsApp click jika diperlukan
                    console.log('WhatsApp button clicked');
                });
            }
        });
    </script>

    <!-- Firebase SDK -->
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js';
        import { 
            getFirestore, 
            doc, 
            getDoc,
            collection,
            query,
            where,
            limit,
            getDocs
        } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js';

        // Firebase configuration (same as other pages)
        const firebaseConfig = {
            apiKey: "AIzaSyA51F2pPZUWmdOaYqsihD78LTrvnXDqXn4",
            authDomain: "taqi-4a756.firebaseapp.com",
            projectId: "taqi-4a756",
            storageBucket: "taqi-4a756.firebasestorage.app",
            messagingSenderId: "836265831490",
            appId: "1:836265831490:web:38277600db742f145451db"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Get plant ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        const plantId = urlParams.get('id');

        // Format price to USD
        function formatPrice(price) {
            if (!price && price !== 0) return 'Price not available';
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(price);
        }

        // Translation dictionary
        const translations = {
            // Categories
            'indoor': 'Indoor Plant',
            'outdoor': 'Outdoor Plant',
            'langka': 'Rare Plant',
            'sukulen': 'Succulent',
            'hias': 'Ornamental Plant',
            'monstera': 'Monstera',
            'aglaonema': 'Aglaonema',
            'philodendron': 'Philodendron',
            
            // Light conditions
            'Rendah (teduh)': 'Low (shade)',
            'Sedang (cahaya tidak langsung)': 'Medium (indirect light)',
            'Tinggi (cahaya terang)': 'High (bright light)',
            'Sinar matahari langsung': 'Direct sunlight',
            
            // Water needs
            'Sedikit (biarkan kering di antara penyiraman)': 'Low (let dry between waterings)',
            'Sedang (siram saat tanah kering)': 'Medium (water when dry)',
            'Banyak (jaga tanah tetap lembap)': 'High (keep soil moist)',
            'Sangat banyak (tanah selalu basah)': 'Very high (keep soil wet)',
            
            // Humidity
            'Rendah (kering)': 'Low (dry)',
            'Sedang (normal)': 'Medium (normal)',
            'Tinggi (lembap)': 'High (humid)',
            'Sangat tinggi (sangat lembap)': 'Very high (very humid)',
            
            // Toxicity
            'Aman untuk hewan peliharaan': 'Pet safe',
            'Beracun jika tertelan': 'Toxic if ingested',
            'Beracun bagi kucing': 'Toxic to cats',
            'Beracun bagi anjing': 'Toxic to dogs'
        };

        // Function to translate text
        function translateText(text) {
            if (!text) return '';
            return translations[text] || text;
        }

        // Format category name with translation
        function formatCategory(category) {
            if (!category) return 'Plant';
            return translateText(category);
        }

        // Load plant details
        async function loadPlantDetails() {
            if (!plantId) {
                showError();
                return;
            }

            try {
                const docRef = doc(db, 'artifacts/taqi-4a756/public/data/plants', plantId);
                const docSnap = await getDoc(docRef);

                if (docSnap.exists()) {
                    const plant = { id: docSnap.id, ...docSnap.data() };

                    // Translate plant data
                    const translatedPlant = {
                        ...plant,
                        category: translateText(plant.category),
                        light: translateText(plant.light),
                        water: translateText(plant.water),
                        humidity: translateText(plant.humidity),
                        toxicity: translateText(plant.toxicity),
                        description: translateText(plant.description)
                    };

                    // Update the UI with translated plant data
                    document.getElementById('plantName').textContent = plant.name; // Keep plant name in original language
                    document.getElementById('plantCategory').textContent = translatedPlant.category;
                    document.getElementById('plantPrice').textContent = formatPrice(plant.price);
                    document.getElementById('plantDescription').textContent = translatedPlant.description || 'No description available.';
                    document.getElementById('plantLight').textContent = translatedPlant.light || '-';
                    document.getElementById('plantWater').textContent = translatedPlant.water || '-';
                    document.getElementById('plantHumidity').textContent = translatedPlant.humidity || '-';
                    document.getElementById('plantToxicity').textContent = translatedPlant.toxicity || '-';

                    // Update UI Utama
                    const mainImg = document.getElementById('plantImage');
                    mainImg.src = plant.imageUrl || 'https://via.placeholder.com/600x600?text=No+Image';
                    
                    // --- LOGIKA GALLERY BARU DIMULAI DISINI ---
                    const galleryContainer = document.getElementById('imageGallery');
                    galleryContainer.innerHTML = ''; // Bersihkan gallery sebelumnya

                    // Daftar semua kemungkinan field gambar
                    const imageFields = ['imageUrl', 'imageUrl2', 'imageUrl3', 'imageUrl4', 'imageUrl5'];
                    
                    imageFields.forEach(field => {
                        if (plant[field] && plant[field].trim() !== "") {
                            // Buat elemen thumbnail
                            const thumb = document.createElement('img');
                            thumb.src = plant[field];
                            thumb.className = "w-20 h-20 object-cover rounded-md cursor-pointer border-2 border-transparent hover:border-[#4f7962] transition shadow-sm";
                            
                            // Event klik untuk mengganti gambar utama
                            thumb.onclick = () => {
                                mainImg.src = plant[field];
                                // Reset border semua thumbnail dan beri highlight pada yang aktif
                                document.querySelectorAll('#imageGallery img').forEach(img => img.classList.remove('border-[#4f7962]'));
                                thumb.classList.add('border-[#4f7962]');
                            };
                            
                            galleryContainer.appendChild(thumb);
                        }
                    });
                    // --- LOGIKA GALLERY BARU BERAKHIR DISINI ---

                    // Update teks detail lainnya
                    document.getElementById('plantName').textContent = plant.name;
                    document.getElementById('plantCategory').textContent = translatedPlant.category;
                    
                    // Update WhatsApp button with plant name
                    const whatsappBtn = document.querySelector('.whatsapp-btn');
                    whatsappBtn.href = `https://wa.me/6285121090713?text=Hello%20Taqi%20Garden,%20I%20am%20interested%20in%20${encodeURIComponent(plant.name)}.`;

                    // Update contact button
                    const contactBtn = document.getElementById('contactBtn');
                    contactBtn.onclick = () => window.open(whatsappBtn.href, '_blank');

                    // Load similar plants (passing translated category)
                    loadSimilarPlants(translatedPlant.category, plant.id);

                    document.getElementById('loading').classList.add('hidden');
                    document.getElementById('plantDetail').classList.remove('hidden');
                } else {
                    showError();
                }
            } catch (error) {
                console.error("Error loading plant:", error);
                showError();
            }
        }

        // Load similar plants
        async function loadSimilarPlants(category, excludeId) {
            if (!category) return;
            
            try {
                const q = query(
                    collection(db, 'artifacts/taqi-4a756/public/data/plants'),
                    where('category', '==', category),
                    limit(4)
                );
                
                const querySnapshot = await getDocs(q);
                const similarPlants = [];
                
                querySnapshot.forEach((doc) => {
                    if (doc.id !== excludeId) {
                        similarPlants.push({ id: doc.id, ...doc.data() });
                    }
                });
                
                displaySimilarPlants(similarPlants);
            } catch (error) {
                console.error("Error loading similar plants:", error);
            }
        }

        // Display similar plants
        function displaySimilarPlants(plants) {
            const container = document.getElementById('similarPlants');
            
            if (!plants.length) {
                container.innerHTML = '<p class="col-span-4 text-center text-gray-500">No similar plants found.</p>';
                return;
            }
            
            const plantsHTML = plants.map(plant => `
                <div class="group">
                    <a href="plant-detail.html?id=${plant.id}" class="block">
                        <div class="bg-white rounded-lg overflow-hidden shadow-md hover:shadow-xl transition-shadow">
                            <div class="aspect-square bg-gray-100 overflow-hidden">
                                <img src="${plant.imageUrl || plant.img || 'https://via.placeholder.com/300x300?text=No+Image'}" 
                                     alt="${plant.name}" 
                                     class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300">
                            </div>
                            <div class="p-4">
                                <h3 class="font-semibold text-lg mb-1">${plant.name}</h3>
                                <p class="text-[#4f7962] font-bold">${formatPrice(plant.price)}</p>
                            </div>
                        </div>
                    </a>
                </div>
            `).join('');
            
            container.innerHTML = plantsHTML;
        }

        // Show error message
        function showError() {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('errorMessage').classList.remove('hidden');
        }

        // Toggle mobile menu
        function toggleMenu() {
            const mobileMenu = document.getElementById('mobile-menu');
            mobileMenu.classList.toggle('translate-x-full');
            mobileMenu.classList.toggle('translate-x-0');
        }

       // Event listeners
document.addEventListener('DOMContentLoaded', () => {
    // Toggle mobile menu - only if elements exist
    const menuToggle = document.getElementById('menu-toggle');
    const menuClose = document.getElementById('menu-close');
    
    if (menuToggle) menuToggle.addEventListener('click', toggleMenu);
    if (menuClose) menuClose.addEventListener('click', toggleMenu);
    
    // Load plant details
    loadPlantDetails();
});
    </script>
</body>
</html>
