<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Articles - Taqi Garden</title>
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="img/logo.png">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/style.css">
    <style>
        .article-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .article-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .article-category {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background-color: #2d4a3e;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
    </style>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Inter:wght@300;400;600&display=swap');
        :root { --primary-green: #2d4a3e; --accent-green: #4f7962; --cream: #f9f7f2; }
        body { font-family: 'Inter', sans-serif; background-color: var(--cream); color: #333; }
        h1, h2, h3, .brand-font { font-family: 'Playfair Display', serif; }
        .form-input:focus { border-color: var(--accent-green); box-shadow: 0 0 0 1px var(--accent-green); }
        .btn-primary { background-color: var(--primary-green); transition: all 0.3s ease; }
        .btn-primary:hover { background-color: var(--accent-green); transform: translateY(-2px); }
        
       .whatsapp-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background-color: #25D366;
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            text-align: center;
            font-size: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

       .whatsapp-btn:hover {
            transform: scale(1.1);
            background-color: #128c7e;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <div id="header"></div>

    <!-- Hero Section -->
    <section class="bg-gradient-to-r from-[#2d4a3e] to-[#3a6b5b] text-white py-16 md:py-24">
        <div class="container mx-auto px-4 text-center">
            <h1 class="text-3xl md:text-4xl font-bold mb-4">Gardening Articles & Tips</h1>
            <p class="text-lg md:text-xl text-gray-100 max-w-3xl mx-auto">Discover various interesting articles about plants, care, and gardening tips for your home</p>
        </div>
    </section>

    <!-- Articles Section -->
    <section class="py-12 md:py-16 bg-white">
        <div class="container mx-auto px-4">
            <!-- Filter & Search -->
            <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
                <div class="relative" id="filterContainer">
                    <button id="filterButton" 
                            class="flex items-center gap-2 px-4 py-2 border border-[#2d4a3e] rounded-lg text-[#2d4a3e] hover:bg-[#2d4a3e] hover:text-white transition-colors">
                        <i class="fas fa-filter"></i>
                        <span>Category</span>
                    </button>
                    
                    <!-- Dropdown Menu -->
                    <div id="filterDropdown" 
                        class="hidden absolute z-10 mt-2 w-48 bg-white rounded-md shadow-lg py-1">
                        <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" 
                        onclick="filterArticles('semua'); return false;">
                            <i class="fas fa-th-large mr-2 w-5 text-center"></i> All Articles
                        </a>
                        <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                        onclick="filterArticles('perawatan'); return false;">
                            <i class="fas fa-leaf mr-2 w-5 text-center"></i> Plant Care
                        </a>
                        <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                        onclick="filterArticles('tips'); return false;">
                            <i class="fas fa-lightbulb mr-2 w-5 text-center"></i> Tips & Tricks
                        </a>
                        <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                        onclick="filterArticles('inspirasi'); return false;">
                            <i class="fas fa-palette mr-2 w-5 text-center"></i> Garden Inspiration
                        </a>
                    </div>
                </div>
                <div class="relative w-full md:w-64">
                    <input type="text" id="searchInput" placeholder="Search articles..." 
                        class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#2d4a3e] focus:border-transparent outline-none text-sm">
                    <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                </div>
            </div>

            <!-- Loading Spinner -->
            <div id="loading" class="col-span-full text-center py-12">
                <div class="inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-[#2d4a3e]"></div>
                <p class="mt-4 text-gray-600">Loading articles...</p>
            </div>

            <!-- Articles Grid -->
            <div id="articlesGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Articles will be loaded here dynamically -->
            </div>

            <!-- Pagination will be added here if needed -->
        </div>
    </section>
    <!-- Footer -->
    <div id="footer"></div>

    <!-- Firebase SDK -->
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js';
        import { 
            getFirestore, 
            collection, 
            getDocs, 
            query, 
            orderBy,
            where
        } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js';
        
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyA51F2pPZUWmdOaYqsihD78LTrvnXDqXn4",
            authDomain: "taqi-4a756.firebaseapp.com",
            projectId: "taqi-4a756",
            storageBucket: "taqi-4a756.firebasestorage.app",
            messagingSenderId: "836265831490",
            appId: "1:836265831490:web:38277600db742f145451db"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // DOM elements
        const articlesGrid = document.getElementById('articlesGrid');
        const loadingElement = document.getElementById('loading');
        let articles = [];

        // Load header and footer
        document.addEventListener('DOMContentLoaded', function() {
            // Load header
            fetch('includes/header.html')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('header').innerHTML = data;
                    // Add active class to current page in navigation
                    const navLinks = document.querySelectorAll('.nav-link');
                    navLinks.forEach(link => {
                        if (link.getAttribute('href') === 'artikel.html') {
                            link.classList.add('text-[#2d4a3e]', 'font-medium');
                            link.classList.add('active');
                        }
                    });
                });

            // Load footer
            fetch('includes/footer.html')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('footer').innerHTML = data;
                });

            // Load articles
            loadArticles();
        });

        // Load articles from Firestore
        async function loadArticles(category = 'semua') {
            try {
                console.log('Loading articles...');
                loadingElement.classList.remove('hidden');
                articlesGrid.innerHTML = '';
                
                let articlesQuery;
                const articlesRef = collection(db, 'artifacts/taqi-4a756/public/data/atricles');
                console.log('Articles collection reference created');
                
                if (category === 'semua') {
                    console.log('Fetching all articles');
                    articlesQuery = query(articlesRef, orderBy('createdAt', 'desc'));
                } else {
                    console.log(`Filtering articles by category: ${category}`);
                    articlesQuery = query(articlesRef, 
                        where('category', '==', category),
                        orderBy('createdAt', 'desc')
                    );
                }

                console.log('Executing Firestore query...');
                const querySnapshot = await getDocs(articlesQuery);
                console.log(`Query completed. Found ${querySnapshot.size} documents`);
                
                articles = [];
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    console.log('Document data:', doc.id, data);
                    articles.push({ id: doc.id, ...data });
                });

                console.log('Articles loaded:', articles);
                displayArticles(articles);
            } catch (error) {
                console.error("Error loading articles: ", error);
                articlesGrid.innerHTML = `
                    <div class="col-span-full text-center py-8">
                        <i class="fas fa-exclamation-triangle text-yellow-500 text-4xl mb-4"></i>
                        <p class="text-gray-600">Failed to load articles. Please try again later.</p>
                    </div>
                `;
            } finally {
                loadingElement.classList.add('hidden');
            }
        }

        // Display articles in the grid
        function displayArticles(articlesToShow) {
            console.log('Displaying articles:', articlesToShow);
            if (!articlesToShow || articlesToShow.length === 0) {
                console.log('No articles to display');
                articlesGrid.innerHTML = `
                    <div class="col-span-full text-center py-8">
                        <i class="far fa-newspaper text-gray-400 text-4xl mb-4"></i>
                        <p class="text-gray-600">No articles found.</p>
                        <p class="text-sm text-gray-500 mt-2">Make sure the 'articles' collection exists in Firestore and contains documents.</p>
                        <button onclick="loadArticles()" class="mt-4 text-[#2d4a3e] hover:underline">
                            <i class="fas fa-sync-alt mr-2"></i>Try Reloading
                        </button>
                    </div>
                `;
                return;
            }

            articlesGrid.innerHTML = articlesToShow.map(article => `
                <article class="article-card bg-white rounded-xl overflow-hidden shadow-md border border-gray-100">
                    <div class="relative">
                        <img src="${article.imageUrl || 'https://via.placeholder.com/600x400?text=No+Image'}" 
                             alt="${article.title}" 
                             class="w-full h-48 object-cover">
                        <span class="article-category" style="background-color: ${getCategoryColor(article.category)}">
                            ${getCategoryName(article.category)}
                        </span>
                    </div>
                    <div class="p-6">
                        <div class="flex items-center text-sm text-gray-500 mb-2">
                            <span><i class="far fa-calendar-alt mr-1"></i> ${formatDate(article.createdAt?.toDate())}</span>
                            <span class="mx-2">â€¢</span>
                            <span><i class="far fa-clock mr-1"></i> ${article.readTime || '5'} min read</span>
                        </div>
                        <h3 class="text-xl font-bold text-gray-800 mb-3">${article.title}</h3>
                        <p class="text-gray-600 mb-4">${article.content ? (article.content.substring(0, 50) + (article.content.length > 50 ? '...' : '')) : (article.excerpt || 'No summary available.')}</p>
                        <a href="article-detail.html?id=${article.id}" class="inline-flex items-center text-[#2d4a3e] font-medium hover:underline">
                            Read More
                            <i class="fas fa-arrow-right ml-2"></i>
                        </a>
                    </div>
                </article>
            `).join('');
        }

        // Helper functions
        function formatDate(date) {
            if (!date) return 'Date not available';
            return new Intl.DateTimeFormat('en-US', {
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            }).format(date);
        }

        function getCategoryName(category) {
            const categories = {
                'perawatan': 'Plant Care',
                'tips': 'Tips & Tricks',
                'inspirasi': 'Garden Inspiration'
            };
            return categories[category] || 'Article';
        }

        function getCategoryColor(category) {
            const colors = {
                'perawatan': '#2d4a3e',
                'tips': '#4a7c6d',
                'inspirasi': '#6b5b3a'
            };
            return colors[category] || '#2d4a3e';
        }

        // Filter articles function
        function filterArticles(category) {
            const filterButton = document.getElementById('filterButton').querySelector('span');
            
            // Update button text
            filterButton.textContent = 
                category === 'semua' ? 'All Categories' : 
                category === 'perawatan' ? 'Plant Care' :
                category === 'tips' ? 'Tips & Tricks' : 'Garden Inspiration';
            
            // Load articles with filter
            loadArticles(category === 'semua' ? 'semua' : category);
            
            // Hide dropdown after selection
            document.getElementById('filterDropdown').classList.add('hidden');
        }

        // Search functionality
        document.getElementById('searchInput').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const filteredArticles = articles.filter(article => 
                article.title.toLowerCase().includes(searchTerm) || 
                (article.content && article.content.toLowerCase().includes(searchTerm)) ||
                (article.tags && article.tags.some(tag => tag.toLowerCase().includes(searchTerm)))
            );
            displayArticles(filteredArticles);
        });
    </script>
</body>
</html>